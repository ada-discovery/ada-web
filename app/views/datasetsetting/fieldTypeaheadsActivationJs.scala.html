@import org.ada.server.models.{DataSetSetting, FilterShowFieldStyle, FieldTypeId}
@import org.ada.web.controllers.dataset.DataSetWebContext
@import org.ada.web.controllers.dataset.DataSetWebContext._
@import org.ada.web.controllers.routes

@(
    form: Form[DataSetSetting]
)(
    implicit context: DataSetWebContext
)

@typeaheadJsImport()

<script type="text/javascript">
    $(function () {
        var showOption = @form.value.flatMap(_.filterShowFieldStyle).getOrElse(FilterShowFieldStyle.NamesAndLabels).id

        populateIdNameTypeaheadFromUrl($('#ownerTypeahead'), $('#ownerId'), '@Html(routes.UserController.idAndNames.url)', true)

        $.ajax({
            url: '@Html(dataSetRouter.allFieldNamesAndLabels.url)',
            success: function (fieldNameAndLabels) {
                var fieldNamesAndLabelsWithId = fieldNameAndLabels.concat([["_id", "_id"]])
                var fieldNamesAndLabelsWithNone = fieldNameAndLabels.concat([["", "[None]"]])
                var fieldNamesAndLabelsWithIdAndNone = fieldNamesAndLabelsWithId.concat([["", "[None]"]])

                populateFieldTypeahead($('#keyFieldTypeahead'), $('#keyFieldName'), fieldNamesAndLabelsWithId, showOption, true);
                populateFieldTypeahead($('#exportOrderByFieldTypeahead'), $('#exportOrderByFieldName'), fieldNamesAndLabelsWithIdAndNone, showOption, true);
                populateFieldTypeahead($('#defaultDistributionFieldTypeahead'), $('#defaultDistributionFieldName'), fieldNamesAndLabelsWithNone, showOption, true);
                populateFieldTypeahead($('#defaultCumulativeCountFieldTypeahead'), $('#defaultCumulativeCountFieldName'), fieldNamesAndLabelsWithNone, showOption, true);
            },
            error: showErrorResponse
        });

        $.ajax({
            url: '@Html(dataSetRouter.fieldNamesAndLabels(Seq(FieldTypeId.Double, FieldTypeId.Integer, FieldTypeId.Date)).url)',
            success: function (fieldNameAndLabels) {
                var fieldNamesAndLabelsWithNone = fieldNameAndLabels.concat([["", "[None]"]])

                populateFieldTypeahead($('#defaultScatterXFieldTypeahead'), $('#defaultScatterXFieldName'), fieldNamesAndLabelsWithNone, showOption, true);
                populateFieldTypeahead($('#defaultScatterYFieldTypeahead'), $('#defaultScatterYFieldName'), fieldNamesAndLabelsWithNone, showOption, true);
            },
            error: showErrorResponse
        });
    })
</script>